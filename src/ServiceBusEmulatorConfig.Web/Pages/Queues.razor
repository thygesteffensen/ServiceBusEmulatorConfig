@page "/queues"
@inject IApplicationState ApplicationState;

<PageTitle>Queues - Service Bus Explorer</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge">
    <MudText Typo="Typo.h4" Class="mb-4">Service Bus Queues</MudText>

    @if (!ApplicationState.IsConnected)
    {
        <MudAlert Severity="Severity.Warning" Class="mb-4">
            Not connected to any Service Bus namespace. Please
            <MudLink Href="connection">connect first</MudLink>.
        </MudAlert>
    }
    else if (_pageState.Queues.Count == 0)
    {
        <MudAlert Severity="Severity.Info" Class="mb-4">
            No queues found in this Service Bus namespace.
        </MudAlert>
    }
    else
    {
        <MudGrid>
            <!-- Left Pane - Queue List -->
            <MudItem xs="12" sm="4" md="3">
                <MudPaper Class="pa-4" Elevation="2" Style="height: 100%; overflow: auto;">
                    <MudText Typo="Typo.h6" Class="mb-2">Queue Explorer</MudText>
                    <MudTextField @bind-Value="_searchString" Placeholder="Search" Adornment="Adornment.Start"
                                 AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium"
                                 Class="mb-3"></MudTextField>
                    
                    <MudList T="Queue" clickable="true" Dense="true" disableGutters="true">
                        @foreach (var queue in _pageState.Queues.Where(FilterFunc))
                        {
                            <MudListItem T="Queue" 
                                        Value="queue"
                                        OnClick="@(() => SelectQueue(queue))" 
                                        Icon="@Icons.Material.Filled.Queue"
                                        IconColor="@(_selectedQueue?.Name == queue.Name ? Color.Primary : Color.Default)"
                                        Class="@(_selectedQueue?.Name == queue.Name ? "mud-selected-item" : "")">
                                @queue.Name
                            </MudListItem>
                        }
                    </MudList>
                </MudPaper>
            </MudItem>
            
            <!-- Right Pane - Details -->
            <MudItem xs="12" sm="8" md="9">
                <MudPaper Class="pa-4" Elevation="2" Style="height: 100%; overflow: auto;">
                    @if (_selectedQueue == null)
                    {
                        <MudAlert Severity="Severity.Info">Select a queue from the list to view details.</MudAlert>
                    }
                    else
                    {
                        <QueueDetailsView Queue="@_selectedQueue" />
                    }
                </MudPaper>
            </MudItem>
        </MudGrid>
    }
</MudContainer>
